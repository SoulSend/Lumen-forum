var I=(L,m,g)=>new Promise((V,s)=>{var _=u=>{try{d(g.next(u))}catch(f){s(f)}},y=u=>{try{d(g.throw(u))}catch(f){s(f)}},d=u=>u.done?V(u.value):Promise.resolve(u.value).then(_,y);d((g=g.apply(L,m)).next())});import{x as at,r as i,j,h as ot,H as z,I as r,aA as nt,z as c,A as t,y as p,K as J,O as n,Q as l,M as C,ag as v,J as lt,aq as rt,P,a6 as A,aB as it}from"./vue-vendor-D9-fr2Es.js";import{u as ct,M as dt,a as ut}from"./MainLayout-ce7fSWOU.js";import{P as _t}from"./PostCard-B03o2Dre.js";import{u as pt}from"./postStore-BYDGKwf5.js";import{p as vt}from"./index-D15Qezav.js";import{a as M}from"./ui-vendor-BbrJz_TA.js";import"./utils-vendor-Cfc3znND.js";const mt={class:"category-page"},gt={key:0,class:"category-header"},yt={class:"category-icon"},ft={class:"material-icons-round"},ht={class:"category-info"},Ct={class:"category-meta"},bt={class:"category-title"},kt={class:"category-stats"},wt={class:"stat-item"},zt={class:"stat-item"},Pt={class:"stat-item"},Mt={class:"category-description"},Vt={class:"category-actions"},xt={class:"material-icons-round"},Dt={class:"category-content"},St={class:"content-main"},It={class:"filter-bar"},At={class:"filter-options"},Lt={class:"sort-options"},Bt={class:"posts-container"},Ft={key:0,class:"empty-state"},Nt={class:"pagination-container"},Tt={class:"content-sidebar"},Ut={class:"sidebar-card"},qt={class:"card-body"},Et={class:"about-category"},Ht={key:0,class:"category-rules"},Ot=["innerHTML"],Rt={class:"category-created"},jt={class:"sidebar-card"},Jt={class:"card-body"},Kt={class:"tags-cloud"},Qt={class:"tag-count"},Yt={class:"sidebar-card"},$t={class:"card-body"},Gt={class:"related-categories"},Wt={class:"material-icons-round"},Xt={class:"category-name"},Zt={class:"post-count"},te=at({__name:"Category",setup(L){const m=nt(),g=it(),V=ct();pt();const s=i(null),_=i([]),y=i(!1),d=i(!1),u=i("all"),f=i("newest"),h=i(1),k=i(10),B=i(0),K=i([{id:1,name:"装修",count:42},{id:2,name:"收纳",count:36},{id:3,name:"小户型",count:28},{id:4,name:"DIY",count:24},{id:5,name:"北欧风",count:19},{id:6,name:"绿植",count:15}]);i([{id:101,username:"创意达人",avatar:"",post_count:24},{id:102,username:"家居控",avatar:"",post_count:18},{id:103,username:"设计师小王",avatar:"",post_count:15},{id:104,username:"收纳达人",avatar:"",post_count:12}]);const Q=i([{id:1,name:"生活技巧",post_count:326},{id:3,name:"美食烹饪",post_count:189},{id:5,name:"健康养生",post_count:137}]),F=o=>({生活技巧:"lightbulb",家居装饰:"chair",美食烹饪:"restaurant",旅行探索:"flight",健康养生:"spa",职场技能:"work"})[o]||"category",Y=o=>o?new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"未知",N=()=>I(null,null,function*(){const o=m.params.id;try{const e=yield V.fetchCategory(o);e&&(s.value=e,document.title=`${e.name} - Lumen论坛`,d.value=Math.random()>.5)}catch(e){console.error("Failed to fetch category:",e),M.error("获取分类信息失败")}}),b=()=>I(null,null,function*(){y.value=!0;const o=Array.isArray(m.params.id)?m.params.id[0]:m.params.id;if(!o){M.error("分类ID无效"),y.value=!1;return}try{const e=yield vt.getCategoryPosts(o,h.value,k.value);e&&(_.value=e.content||e.data||[],B.value=e.totalElements||e.total||(_.value?_.value.length:0))}catch(e){console.error("Failed to fetch posts:",e),M.error("获取帖子列表失败")}finally{y.value=!1}}),$=()=>{d.value=!d.value;const o=d.value?"已关注分类":"已取消关注";M.success(o)},T=()=>{s.value?g.push({name:"createPost",query:{category:s.value.id}}):g.push({name:"createPost"})},G=o=>{h.value=o,b()},W=o=>{k.value=o,h.value=1,b()};return j([u,f],()=>{h.value=1,b()}),j(()=>m.params.id,()=>{N(),h.value=1,b()}),ot(()=>{N(),b()}),(o,e)=>{const x=v("el-button"),D=v("el-radio-button"),X=v("el-radio-group"),w=v("el-option"),Z=v("el-select"),tt=v("el-empty"),et=v("el-pagination"),U=v("router-link"),st=rt("loading");return c(),z(dt,null,{default:r(()=>{var q,E,H,O;return[t("div",mt,[s.value?(c(),p("div",gt,[t("div",yt,[t("span",ft,n(F(s.value.name)),1)]),t("div",ht,[t("div",Ct,[t("h1",bt,n(s.value.name),1),t("div",kt,[t("div",wt,[e[4]||(e[4]=t("span",{class:"material-icons-round"},"description",-1)),t("span",null,n(s.value.postCount||s.value.post_count||0)+" 帖子",1)]),t("div",zt,[e[5]||(e[5]=t("span",{class:"material-icons-round"},"comment",-1)),t("span",null,n(s.value.commentCount||s.value.comment_count||0)+" 评论",1)]),t("div",Pt,[e[6]||(e[6]=t("span",{class:"material-icons-round"},"person",-1)),t("span",null,n(s.value.followerCount||s.value.follower_count||0)+" 关注者",1)])])]),t("p",Mt,n(s.value.description),1),t("div",Vt,[l(x,{type:"primary",onClick:T},{default:r(()=>e[7]||(e[7]=[t("span",{class:"material-icons-round"},"add",-1),C(" 发布帖子 ")])),_:1,__:[7]}),l(x,{type:d.value?"success":"default",onClick:$},{default:r(()=>[t("span",xt,n(d.value?"check":"add"),1),C(" "+n(d.value?"已关注":"关注分类"),1)]),_:1},8,["type"])])])])):J("",!0),t("div",Dt,[t("div",St,[t("div",It,[t("div",At,[l(X,{modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),size:"small"},{default:r(()=>[l(D,{value:"all"},{default:r(()=>e[8]||(e[8]=[C("全部")])),_:1,__:[8]}),l(D,{value:"featured"},{default:r(()=>e[9]||(e[9]=[C("精华")])),_:1,__:[9]}),l(D,{value:"solved"},{default:r(()=>e[10]||(e[10]=[C("已解决")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),t("div",Lt,[e[11]||(e[11]=t("span",{class:"sort-label"},"排序：",-1)),l(Z,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),size:"small",style:{width:"120px"}},{default:r(()=>[l(w,{label:"最新发布",value:"newest"}),l(w,{label:"最多评论",value:"most_comments"}),l(w,{label:"最多浏览",value:"most_views"}),l(w,{label:"最多点赞",value:"most_likes"})]),_:1},8,["modelValue"])])]),lt((c(),p("div",Bt,[!y.value&&(!_.value||_.value.length===0)?(c(),p("div",Ft,[l(tt,{description:"暂无帖子"},{description:r(()=>e[12]||(e[12]=[t("p",null,"该分类下暂无帖子",-1)])),default:r(()=>[l(x,{type:"primary",onClick:T},{default:r(()=>e[13]||(e[13]=[t("span",{class:"material-icons-round"},"add",-1),C(" 发布第一篇帖子 ")])),_:1,__:[13]})]),_:1})])):(c(),p(P,{key:1},[(c(!0),p(P,null,A(_.value,a=>(c(),z(_t,{key:a.id,post:a,class:"post-item"},null,8,["post"]))),128)),t("div",Nt,[l(et,{"current-page":h.value,"onUpdate:currentPage":e[2]||(e[2]=a=>h.value=a),"page-size":k.value,"onUpdate:pageSize":e[3]||(e[3]=a=>k.value=a),"page-sizes":[10,20,30,50],total:B.value,layout:"total, sizes, prev, pager, next",onSizeChange:W,onCurrentChange:G,background:""},null,8,["current-page","page-size","total"])])],64))])),[[st,y.value]])]),t("div",Tt,[t("div",Ut,[e[15]||(e[15]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},"关于本分类")],-1)),t("div",qt,[t("div",Et,[t("p",null,n(((q=s.value)==null?void 0:q.description)||"暂无描述"),1),(E=s.value)!=null&&E.rules?(c(),p("div",Ht,[e[14]||(e[14]=t("h4",null,"分类规则：",-1)),t("div",{innerHTML:s.value.rules},null,8,Ot)])):J("",!0),t("div",Rt," 创建于 "+n(Y(((H=s.value)==null?void 0:H.createdAt)||((O=s.value)==null?void 0:O.created_at))),1)])])]),t("div",jt,[e[16]||(e[16]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},"热门标签")],-1)),t("div",Jt,[t("div",Kt,[(c(!0),p(P,null,A(K.value,(a,S)=>{var R;return c(),z(U,{key:S,to:{name:"search",query:{category:(R=s.value)==null?void 0:R.id,tag:a.id}},class:"tag-item"},{default:r(()=>[C(n(a.name)+" ",1),t("span",Qt,n(a.count),1)]),_:2},1032,["to"])}),128))])])]),t("div",Yt,[e[17]||(e[17]=t("div",{class:"card-header"},[t("h3",{class:"card-title"},"相关分类")],-1)),t("div",$t,[t("div",Gt,[(c(!0),p(P,null,A(Q.value,(a,S)=>(c(),z(U,{key:S,to:{name:"category",params:{id:a.id}},class:"related-category"},{default:r(()=>[t("span",Wt,n(F(a.name)),1),t("span",Xt,n(a.name),1),t("span",Zt,n(a.post_count),1)]),_:2},1032,["to"]))),128))])])])])])])]}),_:1})}}}),ce=ut(te,[["__scopeId","data-v-a9907674"]]);export{ce as default};
