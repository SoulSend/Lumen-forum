var we=Object.defineProperty;var j=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,ye=Object.prototype.propertyIsEnumerable;var H=(b,d,i)=>d in b?we(b,d,{enumerable:!0,configurable:!0,writable:!0,value:i}):b[d]=i,u=(b,d)=>{for(var i in d||(d={}))be.call(d,i)&&H(b,i,d[i]);if(j)for(var i of j(d))ye.call(d,i)&&H(b,i,d[i]);return b};var P=(b,d,i)=>new Promise((x,U)=>{var c=_=>{try{r(i.next(_))}catch(y){U(y)}},v=_=>{try{r(i.throw(_))}catch(y){U(y)}},r=_=>_.done?x(_.value):Promise.resolve(_.value).then(c,v);r((i=i.apply(b,d)).next())});import{x as Pe,r as V,X as S,c as Ve,H as I,I as t,z as k,A as a,Q as o,ag as w,V as N,M as g,y as B,O as C,J as he,R as Ue,a6 as Fe,P as ke,n as J}from"./vue-vendor-D9-fr2Es.js";import{g as xe,M as Ce,a as Re}from"./MainLayout-ce7fSWOU.js";import{u as Se}from"./index-D15Qezav.js";import{a as f}from"./ui-vendor-BbrJz_TA.js";import"./utils-vendor-Cfc3znND.js";const Be={class:"settings-page"},Le={class:"settings-container"},Te={class:"avatar-upload"},$e=["src"],qe={class:"security-settings"},Ee={class:"binding-section"},Ae={class:"binding-status"},Me={class:"binding-type"},Ie={class:"binding-info"},Ne={key:0},ze={key:1},De={class:"code-input"},Oe={class:"binding-section"},Ze={class:"binding-status"},je={class:"binding-type"},He={class:"binding-info"},Je={class:"notification-settings"},Qe={class:"settings-section"},Xe={class:"setting-label"},Ge={class:"save-button"},Ke=Pe({__name:"Settings",setup(b){var D,O,Z;const d=Se(),i=V(),x=V(),U=V(),c=S({username:((D=d.currentUser)==null?void 0:D.username)||"",email:((O=d.currentUser)==null?void 0:O.email)||"",bio:((Z=d.currentUser)==null?void 0:Z.bio)||"",avatar:null}),v=S({currentPassword:"",newPassword:"",confirmPassword:""}),r=S({phone:"",code:"",isBound:!1}),_=V(!1),y=V(!1),L=V(!1),F=V(0),p={trigger:["blur","submit"]},Q=Ve(()=>{var s;return c.avatar?URL.createObjectURL(c.avatar):xe((s=d.currentUser)==null?void 0:s.avatar)}),X={username:[u({required:!0,message:"请输入用户名"},p),u({min:3,max:20,message:"用户名长度应为3-20个字符"},p)],email:[u({required:!0,message:"请输入邮箱地址"},p),u({type:"email",message:"请输入有效的邮箱地址"},p)],bio:[u({max:200,message:"个人简介不能超过200个字符"},p)]},G=(s,e,l)=>{e===""?l(new Error("请确认新密码")):e!==v.newPassword?l(new Error("两次输入的密码不一致")):l()},K={currentPassword:[u({required:!0,message:"请输入当前密码"},p)],newPassword:[u({required:!0,message:"请输入新密码"},p),u({min:8,message:"密码长度不能少于8个字符"},p),u({pattern:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/,message:"密码必须包含字母和数字"},p)],confirmPassword:[u({required:!0,message:"请确认新密码"},p),u({validator:G},p)]},W=(s,e,l)=>{if(!e)return l(new Error("请输入手机号码"));if(!/^1[3-9]\d{9}$/.test(e))return l(new Error("请输入有效的手机号码"));l()},Y={phone:[u({required:!0,message:"请输入手机号码"},p),u({validator:W},p)],code:[u({required:!0,message:"请输入验证码"},p),u({min:6,max:6,message:"验证码长度应为6位"},p)]},ee=S([{label:"评论通知",description:"当有用户评论您的帖子时接收通知",value:!0},{label:"点赞通知",description:"当有用户点赞您的帖子或评论时接收通知",value:!0},{label:"@提及通知",description:"当有用户在帖子或评论中@您时接收通知",value:!0},{label:"系统通知",description:"接收系统公告和重要信息的通知",value:!0},{label:"邮件通知",description:"将重要通知同时发送到您的邮箱",value:!1},{label:"短信通知",description:"将重要通知同时发送到您的手机",value:!1}]),T=V(!1),$=V(!1),q=V(!1),z=s=>!s||s.length<11?"":s.substring(0,3)+"****"+s.substring(7),se=s=>{if(!s)return"";const e=s.split("@");if(e.length!==2)return s;const l=e[0],R=e[1];let m=l;return l.length>3&&(m=l.substring(0,3)+"*".repeat(l.length-3)),m+"@"+R},oe=s=>{c.avatar=s.raw},te=()=>P(null,null,function*(){i.value&&(yield i.value.validate(s=>{s&&ae()}))}),ae=()=>P(null,null,function*(){T.value=!0;try{yield new Promise(s=>setTimeout(s,500)),f.success("个人资料已更新")}catch(s){console.error("Failed to update profile:",s),f.error("更新个人资料失败")}finally{T.value=!1}}),le=()=>P(null,null,function*(){x.value&&(yield x.value.validate(s=>{s&&ne()}))}),ne=()=>P(null,null,function*(){$.value=!0;try{yield new Promise(s=>setTimeout(s,500)),f.success("密码已修改，请使用新密码登录"),v.currentPassword="",v.newPassword="",v.confirmPassword="",J(()=>{var s;(s=x.value)==null||s.clearValidate()})}catch(s){console.error("Failed to change password:",s),f.error("修改密码失败，请检查当前密码是否正确")}finally{$.value=!1}}),re=()=>P(null,null,function*(){if(!r.phone)return f.warning("请先输入手机号码");if(!/^1[3-9]\d{9}$/.test(r.phone))return f.warning("请输入有效的手机号码");L.value=!0;try{yield new Promise(l=>setTimeout(l,500)),f.success(`验证码已发送至 ${z(r.phone)}`),F.value=60;const e=setInterval(()=>{F.value--,F.value<=0&&clearInterval(e)},1e3)}catch(e){console.error("Failed to send verification code:",e),f.error("验证码发送失败，请稍后重试")}finally{L.value=!1}}),ie=()=>P(null,null,function*(){U.value&&(yield U.value.validate(s=>{s&&de()}))}),de=()=>P(null,null,function*(){y.value=!0;try{yield new Promise(s=>setTimeout(s,500)),r.isBound=!0,_.value=!1,f.success("手机号绑定成功"),r.code="",F.value=0,J(()=>{var s;(s=U.value)==null||s.clearValidate()})}catch(s){console.error("Failed to bind phone:",s),f.error("手机绑定失败，请检查验证码是否正确")}finally{y.value=!1}}),ue=()=>P(null,null,function*(){y.value=!0;try{yield new Promise(s=>setTimeout(s,500)),r.isBound=!1,r.phone="",f.success("手机号解绑成功")}catch(s){console.error("Failed to unbind phone:",s),f.error("手机解绑失败，请稍后重试")}finally{y.value=!1}}),pe=()=>P(null,null,function*(){q.value=!0;try{yield new Promise(s=>setTimeout(s,500)),f.success("通知设置已保存")}catch(s){console.error("Failed to save notification settings:",s),f.error("保存通知设置失败")}finally{q.value=!1}});return(s,e)=>{const l=w("el-button"),R=w("el-upload"),m=w("el-form-item"),h=w("el-input"),E=w("el-form"),A=w("el-tab-pane"),M=w("el-divider"),me=w("el-collapse-transition"),fe=w("el-tag"),ce=w("el-switch"),ve=w("el-tabs");return k(),I(Ce,null,{default:t(()=>[a("div",Be,[e[29]||(e[29]=a("div",{class:"page-header"},[a("h1",{class:"page-title"},"账号设置")],-1)),a("div",Le,[o(ve,{type:"border-card"},{default:t(()=>[o(A,{label:"个人资料"},{default:t(()=>[o(E,{ref_key:"profileFormRef",ref:i,model:c,rules:X,"label-position":"top",onSubmit:N(te,["prevent"]),"validate-on-rule-change":!1},{default:t(()=>[o(m,{label:"头像",prop:"avatar"},{default:t(()=>[a("div",Te,[a("img",{src:Q.value,alt:"头像",class:"avatar-preview"},null,8,$e),o(R,{class:"avatar-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":oe},{default:t(()=>[o(l,{type:"primary"},{default:t(()=>e[11]||(e[11]=[g("更换头像")])),_:1,__:[11]})]),_:1})])]),_:1}),o(m,{label:"用户名",prop:"username"},{default:t(()=>[o(h,{modelValue:c.username,"onUpdate:modelValue":e[0]||(e[0]=n=>c.username=n),placeholder:"输入用户名"},null,8,["modelValue"])]),_:1}),o(m,{label:"邮箱",prop:"email"},{default:t(()=>[o(h,{modelValue:c.email,"onUpdate:modelValue":e[1]||(e[1]=n=>c.email=n),placeholder:"输入邮箱",type:"email",disabled:""},null,8,["modelValue"]),e[12]||(e[12]=a("small",null,"邮箱地址不可修改，请联系管理员更改",-1))]),_:1,__:[12]}),o(m,{label:"个人简介",prop:"bio"},{default:t(()=>[o(h,{modelValue:c.bio,"onUpdate:modelValue":e[2]||(e[2]=n=>c.bio=n),type:"textarea",placeholder:"介绍一下自己吧",rows:"4",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(m,null,{default:t(()=>[o(l,{type:"primary","native-type":"submit",loading:T.value},{default:t(()=>e[13]||(e[13]=[g("保存个人资料")])),_:1,__:[13]},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),o(A,{label:"安全设置"},{default:t(()=>[a("div",qe,[e[25]||(e[25]=a("h3",null,"登录密码",-1)),o(M),o(E,{ref_key:"passwordFormRef",ref:x,model:v,rules:K,"label-position":"top",onSubmit:N(le,["prevent"]),"validate-on-rule-change":!1},{default:t(()=>[o(m,{label:"当前密码",prop:"currentPassword"},{default:t(()=>[o(h,{modelValue:v.currentPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>v.currentPassword=n),placeholder:"输入当前密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),o(m,{label:"新密码",prop:"newPassword"},{default:t(()=>[o(h,{modelValue:v.newPassword,"onUpdate:modelValue":e[4]||(e[4]=n=>v.newPassword=n),placeholder:"输入新密码",type:"password","show-password":""},null,8,["modelValue"]),e[14]||(e[14]=a("small",null,"密码长度不少于8个字符，包含字母和数字",-1))]),_:1,__:[14]}),o(m,{label:"确认新密码",prop:"confirmPassword"},{default:t(()=>[o(h,{modelValue:v.confirmPassword,"onUpdate:modelValue":e[5]||(e[5]=n=>v.confirmPassword=n),placeholder:"再次输入新密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),o(m,null,{default:t(()=>[o(l,{type:"primary","native-type":"submit",loading:$.value},{default:t(()=>e[15]||(e[15]=[g("修改密码")])),_:1,__:[15]},8,["loading"])]),_:1})]),_:1},8,["model"]),e[26]||(e[26]=a("h3",{class:"section-title"},"账号绑定",-1)),o(M),a("div",Ee,[a("div",Ae,[a("div",Me,[e[18]||(e[18]=a("span",{class:"material-icons-round"},"smartphone",-1)),a("div",Ie,[e[17]||(e[17]=a("strong",null,"手机绑定",-1)),r.isBound?(k(),B("p",Ne,[g(" 已绑定："+C(z(r.phone))+" ",1),o(l,{type:"danger",link:"",onClick:ue,loading:y.value},{default:t(()=>e[16]||(e[16]=[g("解绑")])),_:1,__:[16]},8,["loading"])])):(k(),B("p",ze,"未绑定手机号，绑定后可用于登录和找回密码"))])]),r.isBound?(k(),I(l,{key:1,onClick:e[7]||(e[7]=n=>_.value=!0)},{default:t(()=>e[20]||(e[20]=[g("修改绑定")])),_:1,__:[20]})):(k(),I(l,{key:0,onClick:e[6]||(e[6]=n=>_.value=!0)},{default:t(()=>e[19]||(e[19]=[g("立即绑定")])),_:1,__:[19]}))]),o(me,null,{default:t(()=>[he(a("div",null,[o(E,{ref_key:"phoneFormRef",ref:U,model:r,rules:Y,"label-position":"top",onSubmit:N(ie,["prevent"]),"validate-on-rule-change":!1,class:"phone-form"},{default:t(()=>[o(m,{label:"手机号码",prop:"phone"},{default:t(()=>[o(h,{modelValue:r.phone,"onUpdate:modelValue":e[8]||(e[8]=n=>r.phone=n),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1}),o(m,{label:"验证码",prop:"code"},{default:t(()=>[a("div",De,[o(h,{modelValue:r.code,"onUpdate:modelValue":e[9]||(e[9]=n=>r.code=n),placeholder:"请输入验证码",maxlength:"6"},null,8,["modelValue"]),o(l,{disabled:F.value>0,onClick:re,loading:L.value},{default:t(()=>[g(C(F.value>0?`${F.value}秒后重发`:"获取验证码"),1)]),_:1},8,["disabled","loading"])])]),_:1}),o(m,null,{default:t(()=>[o(l,{type:"primary","native-type":"submit",loading:y.value},{default:t(()=>[g(C(r.isBound?"更新手机绑定":"绑定手机"),1)]),_:1},8,["loading"]),o(l,{onClick:e[10]||(e[10]=n=>_.value=!1)},{default:t(()=>e[21]||(e[21]=[g("取消")])),_:1,__:[21]})]),_:1})]),_:1},8,["model"])],512),[[Ue,_.value]])]),_:1})]),a("div",Oe,[a("div",Ze,[a("div",je,[e[23]||(e[23]=a("span",{class:"material-icons-round"},"email",-1)),a("div",He,[e[22]||(e[22]=a("strong",null,"邮箱绑定",-1)),a("p",null,"已绑定："+C(se(c.email)),1)])]),o(fe,{type:"success"},{default:t(()=>e[24]||(e[24]=[g("已绑定")])),_:1,__:[24]})])])])]),_:1}),o(A,{label:"通知设置"},{default:t(()=>[a("div",Je,[e[28]||(e[28]=a("h3",null,"通知接收设置",-1)),o(M),a("div",Qe,[(k(!0),B(ke,null,Fe(ee,(n,_e)=>(k(),B("div",{class:"setting-item",key:_e},[a("div",Xe,[a("h4",null,C(n.label),1),a("p",null,C(n.description),1)]),o(ce,{modelValue:n.value,"onUpdate:modelValue":ge=>n.value=ge},null,8,["modelValue","onUpdate:modelValue"])]))),128)),a("div",Ge,[o(l,{type:"primary",loading:q.value,onClick:pe},{default:t(()=>e[27]||(e[27]=[g("保存设置")])),_:1,__:[27]},8,["loading"])])])])]),_:1})]),_:1})])])]),_:1})}}}),as=Re(Ke,[["__scopeId","data-v-2cf83222"]]);export{as as default};
