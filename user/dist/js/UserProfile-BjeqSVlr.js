var P=(Q,$,C)=>new Promise((N,o)=>{var w=g=>{try{b(C.next(g))}catch(U){o(U)}},h=g=>{try{b(C.throw(g))}catch(U){o(U)}},b=g=>g.done?N(g.value):Promise.resolve(g.value).then(w,h);b((C=C.apply(Q,$)).next())});import{x as Se,r as n,c as re,j as Ae,h as Me,H as L,I as s,aA as xe,z as d,J as Ie,Q as l,aq as Te,y as c,K as y,A as t,C as Y,u as K,O as f,M as i,ag as v,P as Be,a6 as Fe,aB as Le}from"./vue-vendor-D9-fr2Es.js";import{M as $e,g as Ne,a as Oe}from"./MainLayout-ce7fSWOU.js";import{P as Re}from"./PostCard-B03o2Dre.js";import{u as Ze}from"./postStore-BYDGKwf5.js";import{u as Ee,p as Ge}from"./index-D15Qezav.js";import{a as p,q as ue}from"./ui-vendor-BbrJz_TA.js";import"./utils-vendor-Cfc3znND.js";const je={class:"user-profile-page"},He={key:0,class:"profile-container"},Je={class:"profile-header"},qe={class:"user-info-wrapper"},We={class:"avatar-container"},Ye=["src","alt"],Ke={key:0,class:"status-badge online"},Qe={class:"user-info"},Xe={class:"name-row"},et={class:"user-name"},tt={key:0,class:"role-badge admin"},at={key:1,class:"role-badge moderator"},st={class:"user-meta"},ot={class:"meta-item"},lt={class:"meta-item"},nt={class:"user-bio"},it={class:"action-buttons"},rt={key:0,class:"action-buttons-container"},ut={class:"profile-stats"},dt={class:"stat-card"},ct={class:"stat-value"},vt={class:"stat-card"},pt={class:"stat-value"},mt={class:"stat-card"},_t={class:"stat-value"},ft={class:"stat-card"},gt={class:"stat-value"},yt={key:1,class:"profile-main"},wt={class:"profile-content"},bt={class:"content-tabs-container"},kt={class:"tab-content"},Ct={class:"content-header"},ht={class:"content-title"},Ut={class:"content-filters"},Vt={key:0,class:"loading-content"},Dt={key:1,class:"empty-content"},Pt={key:2,class:"post-list"},zt={class:"pagination-container"},St={class:"tab-content"},At={class:"content-header"},Mt={class:"content-title"},xt={class:"empty-content"},It={class:"tab-content"},Tt={class:"content-header"},Bt={class:"content-title"},Ft={class:"empty-content"},Lt={class:"tab-content"},$t={class:"empty-content"},Nt={key:2,class:"not-found"},Ot={class:"bio-edit-container"},Rt={class:"dialog-footer"},Zt={class:"dialog-footer"},Et={class:"dialog-footer"},Gt=Se({__name:"UserProfile",setup(Q){const $=xe(),C=Le();Ze();const N=Ee(),o=n(null),w=n([]),h=n(!0),b=n(!1),g=n(0),U=n(!1),X=n("posts"),E=n("recent"),z=n(1),O=n(5),ee=n(0);n(!1);const S=n(""),G=n(!1),A=n(!1),j=n(null),M=n(""),H=n(!1),x=n(!1),J=n(null),I=n(""),q=n(!1),T=n(!1),de=re(()=>{var a;return(a=o.value)!=null&&a.cover_image?{backgroundImage:`url(${o.value.cover_image})`}:{}});n([{name:"优质创作者",description:"发布10篇高质量帖子",icon:"auto_awesome",level:"gold",date:"2023-04-15T00:00:00Z"},{name:"活跃评论者",description:"发表30条评论",icon:"comment",level:"silver",date:"2023-03-10T00:00:00Z"},{name:"新手上路",description:"成功注册并完善个人资料",icon:"person",level:"bronze",date:"2023-01-01T00:00:00Z"}]),n([{id:2,name:"家居装饰",post_count:8,total_posts:12},{id:1,name:"生活技巧",post_count:3,total_posts:12},{id:4,name:"旅行探索",post_count:1,total_posts:12}]),n([{type:"post",content:'发布了帖子 <a href="#">如何打造舒适的居家办公环境</a>',time:new Date(Date.now()-2*60*60*1e3).toISOString()},{type:"comment",content:'评论了帖子 <a href="#">10种常见室内植物的养护方法</a>',time:new Date(Date.now()-5*60*60*1e3).toISOString()},{type:"like",content:'收藏了帖子 <a href="#">小户型收纳技巧分享</a>',time:new Date(Date.now()-1*24*60*60*1e3).toISOString()},{type:"achievement",content:"获得成就 <strong>活跃评论者</strong>",time:new Date(Date.now()-3*24*60*60*1e3).toISOString()}]),n([{id:101,username:"创意达人",avatar:"",title:"家居设计师"},{id:102,username:"美食家",avatar:"",title:"烹饪爱好者"},{id:103,username:"旅行者",avatar:"",title:"环球旅行家"}]),n([{id:1,name:"家居装饰",count:8},{id:2,name:"厨房收纳",count:5},{id:3,name:"极简主义",count:7},{id:4,name:"手工DIY",count:3},{id:5,name:"植物养护",count:6},{id:6,name:"旅行攻略",count:4},{id:7,name:"摄影技巧",count:2}]),n([{name:"家居设计",level:90},{name:"植物养护",level:75},{name:"摄影",level:60},{name:"烹饪",level:85},{name:"DIY手工",level:70}]),n([{name:"微博",icon:"public",url:"https://weibo.com/username"},{name:"知乎",icon:"help_outline",url:"https://zhihu.com/people/username"},{name:"小红书",icon:"book",url:"https://xiaohongshu.com/user/profile/username"},{name:"GitHub",icon:"code",url:"https://github.com/username"}]);const V=re(()=>N.currentUser&&o.value&&N.currentUser.id===o.value.id),te=a=>a?new Date(a).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}):"",ce=a=>{if(!a)return"未知";const e=new Date(a),m=new Date().getTime()-e.getTime(),k=Math.floor(m/1e3),_=Math.floor(k/60),B=Math.floor(_/60),D=Math.floor(B/24);return D>30?te(a):D>0?`${D}天前`:B>0?`${B}小时前`:_>0?`${_}分钟前`:"刚刚"},ae=()=>P(null,null,function*(){h.value=!0;const a=$.params.id;try{yield new Promise(e=>setTimeout(e,500)),o.value={id:Number(a),username:"示例用户",email:"user@example.com",avatar:"",bio:"这是一个示例用户资料，用于展示页面布局和设计。喜欢分享生活技巧和美食烹饪经验。",showEmail:!1,reputation:150,postCount:12,commentCount:45,isAdmin:!1,isModerator:!0,created_at:"2023-01-01T00:00:00Z",updated_at:"2023-01-01T00:00:00Z",post_count:12,comment_count:45,is_admin:!1,is_moderator:!0,last_active_at:new Date().toISOString(),createdAt:"2023-01-01T00:00:00Z",updatedAt:"2023-01-01T00:00:00Z",lastActiveAt:new Date().toISOString()},g.value=28,U.value=Math.random()>.5,document.title=`${o.value.username} - Lumen论坛`,ee.value=o.value.post_count}catch(e){console.error("Failed to fetch user profile:",e),p.error("获取用户资料失败")}finally{h.value=!1}}),R=()=>P(null,null,function*(){const a=$.params.id;b.value=!0;try{yield new Promise(u=>setTimeout(u,300));const e=yield Ge.getUserPosts(a,z.value,O.value);e&&e.data?w.value=e.data:w.value=[]}catch(e){console.error("Failed to fetch user posts:",e),p.error("获取用户帖子失败"),w.value=[]}finally{b.value=!1}}),ve=a=>{z.value=a,R()},pe=a=>{O.value=a,R()},me=()=>{C.push({name:"createPost"})};Ae(E,()=>{z.value=1,R()});const se=()=>{var a;A.value=!0,M.value=((a=o.value)==null?void 0:a.avatar)||"",j.value=null},oe=()=>{var a;x.value=!0,I.value=((a=o.value)==null?void 0:a.cover_image)||"",J.value=null},_e=a=>{a&&a.raw&&fe(a.raw)},fe=a=>{if(!a)return;const e=a.type.startsWith("image/"),u=a.size/1024/1024<2;if(!e)return p.error("只能上传图片文件!"),!1;if(!u)return p.error("图片大小不能超过 2MB!"),!1;j.value=a;const m=new FileReader;return m.onload=k=>{var _;M.value=(_=k.target)==null?void 0:_.result},m.readAsDataURL(a),!1},ge=a=>{a&&a.raw&&ye(a.raw)},ye=a=>{if(!a)return;const e=a.type.startsWith("image/"),u=a.size/1024/1024<5;if(!e)return p.error("只能上传图片文件!"),!1;if(!u)return p.error("图片大小不能超过 5MB!"),!1;J.value=a;const m=new FileReader;return m.onload=k=>{var _;I.value=(_=k.target)==null?void 0:_.result},m.readAsDataURL(a),!1},we=()=>P(null,null,function*(){if(!j.value){p.warning("请先选择图片");return}H.value=!0;try{yield new Promise(a=>setTimeout(a,1e3)),o.value&&(o.value.avatar=M.value,p.success("头像更新成功"),A.value=!1)}catch(a){console.error("Failed to upload avatar:",a),p.error("头像上传失败")}finally{H.value=!1}}),be=()=>P(null,null,function*(){if(!J.value){p.warning("请先选择图片");return}q.value=!0;try{yield new Promise(a=>setTimeout(a,1e3)),o.value&&(o.value.cover_image=I.value,p.success("封面更新成功"),x.value=!1)}catch(a){console.error("Failed to upload cover:",a),p.error("封面上传失败")}finally{q.value=!1}}),ke=()=>{var a;S.value=((a=o.value)==null?void 0:a.bio)||"",T.value=!0},Ce=()=>{T.value=!1,S.value=""},he=()=>P(null,null,function*(){G.value=!0;try{o.value.bio=S.value,yield ae(),p.success("简介保存成功"),T.value=!1}catch(a){console.error("Failed to save bio:",a),p.error("保存简介失败")}finally{G.value=!1}});return Me(()=>{ae(),R()}),(a,e)=>{const u=v("el-button"),m=v("el-dropdown-item"),k=v("router-link"),_=v("el-dropdown-menu"),B=v("el-dropdown"),D=v("el-radio-button"),Ue=v("el-radio-group"),le=v("el-skeleton"),F=v("el-empty"),Ve=v("el-pagination"),Z=v("el-tab-pane"),De=v("el-tabs"),Pe=v("el-input"),W=v("el-dialog"),ze=Te("loading");return d(),L($e,null,{default:s(()=>{var ne,ie;return[Ie((d(),c("div",je,[o.value?(d(),c("div",He,[t("div",Je,[t("div",{class:"cover-image",style:Y(de.value)},[V.value?(d(),c("div",{key:0,class:"cover-edit-overlay",onClick:oe},e[10]||(e[10]=[t("span",{class:"material-icons-round"},"photo_camera",-1),t("span",{class:"edit-text"},"更换封面",-1)]))):y("",!0)],4),t("div",qe,[t("div",We,[t("img",{src:K(Ne)((ne=o.value)==null?void 0:ne.avatar),alt:((ie=o.value)==null?void 0:ie.username)||"用户",class:"avatar avatar--xlarge"},null,8,Ye),U.value?(d(),c("div",Ke)):y("",!0),V.value?(d(),c("div",{key:1,class:"avatar-edit-overlay",onClick:se},e[11]||(e[11]=[t("span",{class:"material-icons-round"},"photo_camera",-1),t("span",{class:"edit-text"},"更换头像",-1)]))):y("",!0)]),t("div",Qe,[t("div",Xe,[t("h1",et,f(o.value.username),1),o.value.isAdmin||o.value.is_admin?(d(),c("div",tt,e[12]||(e[12]=[t("span",{class:"material-icons-round"},"verified",-1),i(" 管理员 ")]))):o.value.isModerator||o.value.is_moderator?(d(),c("div",at,e[13]||(e[13]=[t("span",{class:"material-icons-round"},"shield",-1),i(" 版主 ")]))):y("",!0)]),t("div",st,[t("div",ot,[e[14]||(e[14]=t("span",{class:"material-icons-round"},"calendar_today",-1)),t("span",null,"加入于 "+f(te(o.value.createdAt||o.value.created_at)),1)]),t("div",lt,[e[15]||(e[15]=t("span",{class:"material-icons-round"},"schedule",-1)),t("span",null,"最后活跃 "+f(ce(o.value.lastActiveAt||o.value.last_active_at)),1)])]),t("p",nt,f(o.value.bio||"这个用户很懒，什么都没留下"),1)]),t("div",it,[V.value?y("",!0):(d(),c("div",rt,[l(u,{type:"primary",size:"small",class:"follow-btn"},{default:s(()=>e[16]||(e[16]=[t("span",{class:"material-icons-round"},"person_add",-1),i(" 关注 ")])),_:1,__:[16]}),l(u,{type:"primary",size:"small",class:"message-btn"},{default:s(()=>e[17]||(e[17]=[t("span",{class:"material-icons-round"},"mail",-1),i(" 私信 ")])),_:1,__:[17]})])),V.value?(d(),L(B,{key:1},{dropdown:s(()=>[l(_,null,{default:s(()=>[l(m,{onClick:ke},{default:s(()=>e[19]||(e[19]=[t("span",{class:"material-icons-round"},"subject",-1),i(" 编辑简介 ")])),_:1,__:[19]}),l(m,null,{default:s(()=>[l(k,{to:"/settings",class:"dropdown-link"},{default:s(()=>e[20]||(e[20]=[t("span",{class:"material-icons-round"},"settings",-1),i(" 账号设置 ")])),_:1,__:[20]})]),_:1}),l(m,{onClick:se},{default:s(()=>e[21]||(e[21]=[t("span",{class:"material-icons-round"},"image",-1),i(" 更换头像 ")])),_:1,__:[21]}),l(m,{onClick:oe},{default:s(()=>e[22]||(e[22]=[t("span",{class:"material-icons-round"},"wallpaper",-1),i(" 更换封面 ")])),_:1,__:[22]})]),_:1})]),default:s(()=>[l(u,{type:"primary",size:"small",class:"edit-profile-btn"},{default:s(()=>e[18]||(e[18]=[t("span",{class:"material-icons-round edit-icon"},"edit",-1),i(" 编辑资料 ")])),_:1,__:[18]})]),_:1})):y("",!0)])])]),t("div",ut,[t("div",dt,[t("div",ct,f(o.value.post_count),1),e[23]||(e[23]=t("div",{class:"stat-label"},[t("span",{class:"material-icons-round"},"description"),i(" 帖子 ")],-1))]),t("div",vt,[t("div",pt,f(o.value.comment_count),1),e[24]||(e[24]=t("div",{class:"stat-label"},[t("span",{class:"material-icons-round"},"comment"),i(" 评论 ")],-1))]),t("div",mt,[t("div",_t,f(o.value.reputation),1),e[25]||(e[25]=t("div",{class:"stat-label"},[t("span",{class:"material-icons-round"},"trending_up"),i(" 声望 ")],-1))]),t("div",ft,[t("div",gt,f(g.value),1),e[26]||(e[26]=t("div",{class:"stat-label"},[t("span",{class:"material-icons-round"},"people"),i(" 关注者 ")],-1))])])])):y("",!0),o.value?(d(),c("div",yt,[t("div",wt,[t("div",bt,[l(De,{modelValue:X.value,"onUpdate:modelValue":e[3]||(e[3]=r=>X.value=r),class:"profile-tabs"},{default:s(()=>[l(Z,{name:"posts"},{label:s(()=>e[27]||(e[27]=[t("span",{class:"tab-label"},[t("span",{class:"material-icons-round"},"description"),i(" 帖子 ")],-1)])),default:s(()=>[t("div",kt,[t("div",Ct,[t("h2",ht,f(o.value.username)+" 的帖子",1),t("div",Ut,[l(Ue,{modelValue:E.value,"onUpdate:modelValue":e[0]||(e[0]=r=>E.value=r),size:"small"},{default:s(()=>[l(D,{value:"recent"},{default:s(()=>e[28]||(e[28]=[i("最新")])),_:1,__:[28]}),l(D,{value:"popular"},{default:s(()=>e[29]||(e[29]=[i("热门")])),_:1,__:[29]})]),_:1},8,["modelValue"])])]),b.value?(d(),c("div",Vt,[l(le,{rows:3,animated:""}),l(le,{rows:3,animated:"",class:"mt-4"})])):w.value&&w.value.length===0?(d(),c("div",Dt,[l(F,{description:"暂无帖子","image-size":120},{description:s(()=>e[30]||(e[30]=[t("p",null,"该用户尚未发布任何帖子",-1)])),default:s(()=>[V.value?(d(),L(u,{key:0,type:"primary",onClick:me},{default:s(()=>e[31]||(e[31]=[t("span",{class:"material-icons-round"},"add",-1),i(" 发布第一篇帖子 ")])),_:1,__:[31]})):y("",!0)]),_:1})])):(d(),c("div",Pt,[(d(!0),c(Be,null,Fe(w.value,r=>(d(),L(Re,{key:r.id,post:r,class:"post-card-item"},null,8,["post"]))),128)),t("div",zt,[l(Ve,{"current-page":z.value,"onUpdate:currentPage":e[1]||(e[1]=r=>z.value=r),"page-size":O.value,"onUpdate:pageSize":e[2]||(e[2]=r=>O.value=r),"page-sizes":[5,10,20],total:ee.value,layout:"total, sizes, prev, pager, next",onSizeChange:pe,onCurrentChange:ve,background:""},null,8,["current-page","page-size","total"])])]))])]),_:1}),l(Z,{name:"comments"},{label:s(()=>e[32]||(e[32]=[t("span",{class:"tab-label"},[t("span",{class:"material-icons-round"},"comment"),i(" 评论 ")],-1)])),default:s(()=>[t("div",St,[t("div",At,[t("h2",Mt,f(o.value.username)+" 的评论",1)]),t("div",xt,[l(F,{description:"暂无评论","image-size":120},{description:s(()=>e[33]||(e[33]=[t("p",null,"该用户尚未发表任何评论",-1)])),_:1})])])]),_:1}),l(Z,{name:"liked"},{label:s(()=>e[34]||(e[34]=[t("span",{class:"tab-label"},[t("span",{class:"material-icons-round"},"favorite"),i(" 收藏 ")],-1)])),default:s(()=>[t("div",It,[t("div",Tt,[t("h2",Bt,f(o.value.username)+" 的收藏",1)]),t("div",Ft,[l(F,{description:"暂无收藏","image-size":120},{description:s(()=>e[35]||(e[35]=[t("p",null,"该用户尚未收藏任何内容",-1)])),_:1})])])]),_:1}),V.value?(d(),L(Z,{key:0,name:"following"},{label:s(()=>e[36]||(e[36]=[t("span",{class:"tab-label"},[t("span",{class:"material-icons-round"},"people"),i(" 关注 ")],-1)])),default:s(()=>[t("div",Lt,[e[38]||(e[38]=t("div",{class:"content-header"},[t("h2",{class:"content-title"},"我的关注")],-1)),t("div",$t,[l(F,{description:"暂无关注","image-size":120},{description:s(()=>e[37]||(e[37]=[t("p",null,"你尚未关注任何用户",-1)])),_:1})])])]),_:1})):y("",!0)]),_:1},8,["modelValue"])])])])):h.value?y("",!0):(d(),c("div",Nt,[l(F,{description:"用户不存在"})]))])),[[ze,h.value]]),l(W,{modelValue:T.value,"onUpdate:modelValue":e[5]||(e[5]=r=>T.value=r),title:"编辑个人简介",width:"500px","close-on-click-modal":!1,class:"bio-dialog"},{footer:s(()=>[t("span",Rt,[l(u,{onClick:Ce},{default:s(()=>e[40]||(e[40]=[i("取消")])),_:1,__:[40]}),l(u,{type:"primary",onClick:he,loading:G.value},{default:s(()=>e[41]||(e[41]=[i(" 保存 ")])),_:1,__:[41]},8,["loading"])])]),default:s(()=>[t("div",Ot,[e[39]||(e[39]=t("p",{class:"bio-edit-hint"},"介绍一下自己，让大家更了解你（最多200字）",-1)),l(Pe,{modelValue:S.value,"onUpdate:modelValue":e[4]||(e[4]=r=>S.value=r),type:"textarea",rows:5,maxlength:"200","show-word-limit":"",placeholder:"介绍一下自己吧...",class:"bio-textarea"},null,8,["modelValue"])])]),_:1},8,["modelValue"]),l(W,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=r=>A.value=r),title:"更换头像",width:"400px",class:"upload-dialog","close-on-click-modal":!1},{footer:s(()=>[t("span",Zt,[l(u,{onClick:e[6]||(e[6]=r=>A.value=!1)},{default:s(()=>e[43]||(e[43]=[i("取消")])),_:1,__:[43]}),l(u,{type:"primary",onClick:we,loading:H.value},{default:s(()=>e[44]||(e[44]=[i(" 上传头像 ")])),_:1,__:[44]},8,["loading"])])]),default:s(()=>[t("div",{class:"avatar-preview",style:Y({backgroundImage:M.value?`url(${M.value})`:"none"})},null,4),e[45]||(e[45]=t("div",{class:"upload-hint"},[t("p",null,"请选择一张图片作为您的新头像"),t("p",null,"支持 JPG、PNG 格式，文件大小不超过 2MB")],-1)),l(K(ue),{class:"avatar-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":_e,accept:"image/jpeg,image/png"},{default:s(()=>[l(u,{type:"primary",plain:""},{default:s(()=>e[42]||(e[42]=[i("选择图片")])),_:1,__:[42]})]),_:1})]),_:1,__:[45]},8,["modelValue"]),l(W,{modelValue:x.value,"onUpdate:modelValue":e[9]||(e[9]=r=>x.value=r),title:"更换封面",width:"500px",class:"upload-dialog","close-on-click-modal":!1},{footer:s(()=>[t("span",Et,[l(u,{onClick:e[8]||(e[8]=r=>x.value=!1)},{default:s(()=>e[47]||(e[47]=[i("取消")])),_:1,__:[47]}),l(u,{type:"primary",onClick:be,loading:q.value},{default:s(()=>e[48]||(e[48]=[i(" 上传封面 ")])),_:1,__:[48]},8,["loading"])])]),default:s(()=>[t("div",{class:"upload-preview",style:Y({backgroundImage:I.value?`url(${I.value})`:"none"})},null,4),e[49]||(e[49]=t("div",{class:"upload-hint"},[t("p",null,"请选择一张图片作为您的个人主页封面"),t("p",null,"建议尺寸：1200 x 300 像素，支持 JPG、PNG 格式，文件大小不超过 5MB")],-1)),l(K(ue),{class:"cover-uploader",action:"#","auto-upload":!1,"show-file-list":!1,"on-change":ge,accept:"image/jpeg,image/png"},{default:s(()=>[l(u,{type:"primary",plain:""},{default:s(()=>e[46]||(e[46]=[i("选择图片")])),_:1,__:[46]})]),_:1})]),_:1,__:[49]},8,["modelValue"])]}),_:1})}}}),Xt=Oe(Gt,[["__scopeId","data-v-663e934b"]]);export{Xt as default};
