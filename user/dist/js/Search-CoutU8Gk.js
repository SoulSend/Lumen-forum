var T=(S,m,g)=>new Promise((c,u)=>{var l=r=>{try{h(g.next(r))}catch(o){u(o)}},p=r=>{try{h(g.throw(r))}catch(o){u(o)}},h=r=>r.done?c(r.value):Promise.resolve(r.value).then(l,p);h((g=g.apply(S,m)).next())});import{x as j,r as v,c as q,h as H,aA as X,j as Y,H as P,I as y,z as i,A as a,Q as n,a4 as G,u as C,ag as d,M as J,y as _,K as w,P as V,a6 as x,O as b,aB as W}from"./vue-vendor-D9-fr2Es.js";import{o as Z}from"./ui-vendor-BbrJz_TA.js";import{M as $,g as Q,a as ee}from"./MainLayout-ce7fSWOU.js";import{P as ae}from"./PostCard-B03o2Dre.js";import{S as te}from"./Sidebar-D0plc26K.js";import{u as se}from"./postStore-BYDGKwf5.js";import{D as oe}from"./index-D15Qezav.js";import"./utils-vendor-Cfc3znND.js";const ne={class:"search-page"},le={class:"container"},re={class:"search-header"},ie={class:"search-form"},ce={class:"search-content"},ue={class:"content-main"},de={class:"search-filters card"},_e={key:0,class:"search-loading"},me={key:1,class:"no-results card"},pe={key:2,class:"search-results"},ve=["src","alt"],ge={class:"user-info"},he={class:"user-name"},fe={class:"user-bio"},ye={key:2,class:"tags-container card"},ke={class:"tags-list"},be={class:"tag-name"},Te={class:"tag-count"},qe={class:"pagination-container"},Pe={class:"content-sidebar"},Ce=j({__name:"Search",setup(S){const m=X(),g=W();se();const c=v(""),u=v(!1),l=v("all"),p=v(1),h=v(10),r=v(0),o=v([]),M=q(()=>o.value.filter(t=>t.type==="post")),A=q(()=>o.value.filter(t=>t.type==="user")),E=q(()=>o.value.filter(t=>t.type==="tag"));H(()=>{m.query.q?(c.value=m.query.q,f()):m.query.tag_id&&B(m.query.tag_id)}),Y(()=>m.query,t=>{t.q?(c.value=t.q,f()):t.tag_id&&B(t.tag_id)});const f=()=>T(null,null,function*(){if(c.value.trim()){u.value=!0;try{yield new Promise(t=>setTimeout(t,500)),o.value=[{id:1,type:"post",title:"如何提高工作效率的10个小技巧",content:"在现代快节奏的工作环境中，提高效率变得越来越重要...",user:{id:1,username:"效率达人",avatar:"/default-avatar.png"},created_at:"2023-05-15T10:30:00",comment_count:24,like_count:56,view_count:342,category:{id:1,name:"职场技能"},tags:[{id:1,name:"效率"},{id:2,name:"工作"}]},{id:2,type:"post",title:"居家办公的环境布置建议",content:"随着远程工作的普及，如何打造一个高效的居家办公环境变得尤为重要...",user:{id:2,username:"家居达人",avatar:"/default-avatar.png"},created_at:"2023-05-10T14:20:00",comment_count:18,like_count:42,view_count:286,category:{id:2,name:"家居装饰"},tags:[{id:3,name:"居家办公"},{id:4,name:"环境"}]},{id:1,type:"user",username:"效率达人",avatar:"/default-avatar.png",bio:"专注分享提高工作和生活效率的方法和工具",post_count:45,follower_count:1200},{id:1,type:"tag",name:"效率",post_count:128},{id:3,type:"tag",name:"居家办公",post_count:86}],r.value=25}catch(t){console.error("搜索失败:",t),o.value=[]}finally{u.value=!1}}}),B=t=>T(null,null,function*(){u.value=!0;try{yield new Promise(s=>setTimeout(s,500)),o.value=[{id:1,type:"post",title:"如何提高工作效率的10个小技巧",content:"在现代快节奏的工作环境中，提高效率变得越来越重要...",user:{id:1,username:"效率达人",avatar:"/default-avatar.png"},created_at:"2023-05-15T10:30:00",comment_count:24,like_count:56,view_count:342,category:{id:1,name:"职场技能"},tags:[{id:1,name:"效率"},{id:2,name:"工作"}]}],r.value=1,l.value="posts"}catch(s){console.error("按标签搜索失败:",s),o.value=[]}finally{u.value=!1}}),R=()=>{c.value.trim()&&(p.value=1,g.push({name:"search",query:{q:c.value}}),f())},N=()=>{p.value=1,f()},z=t=>{p.value=t,f()};return(t,s)=>{const D=d("el-input"),K=d("el-button"),k=d("el-tab-pane"),L=d("el-tabs"),U=d("el-skeleton"),F=d("el-empty"),I=d("router-link"),O=d("el-pagination");return i(),P($,null,{default:y(()=>[a("div",ne,[a("div",le,[a("div",re,[s[4]||(s[4]=a("h1",{class:"search-title"},"搜索结果",-1)),a("div",ie,[n(D,{modelValue:c.value,"onUpdate:modelValue":s[0]||(s[0]=e=>c.value=e),placeholder:"搜索帖子、话题或用户...","prefix-icon":C(Z),onKeyup:G(R,["enter"]),clearable:"",class:"search-input"},null,8,["modelValue","prefix-icon"]),n(K,{type:"primary",onClick:R},{default:y(()=>s[3]||(s[3]=[J("搜索")])),_:1,__:[3]})])]),a("div",ce,[a("div",ue,[a("div",de,[n(L,{modelValue:l.value,"onUpdate:modelValue":s[1]||(s[1]=e=>l.value=e),onTabChange:N},{default:y(()=>[n(k,{label:"全部",name:"all"}),n(k,{label:"帖子",name:"posts"}),n(k,{label:"用户",name:"users"}),n(k,{label:"标签",name:"tags"})]),_:1},8,["modelValue"])]),u.value?(i(),_("div",_e,[n(U,{rows:3,animated:"",class:"skeleton-card"}),n(U,{rows:3,animated:"",class:"skeleton-card"})])):o.value&&o.value.length===0?(i(),_("div",me,[n(F,{description:"未找到相关结果"}),s[5]||(s[5]=a("div",{class:"search-tips"},[a("h3",null,"搜索建议："),a("ul",null,[a("li",null,"检查您的拼写"),a("li",null,"尝试使用更通用的关键词"),a("li",null,"尝试使用相关的同义词")])],-1))])):(i(),_("div",pe,[l.value==="all"||l.value==="posts"?(i(!0),_(V,{key:0},x(M.value,e=>(i(),P(ae,{key:e.id,post:e},null,8,["post"]))),128)):w("",!0),l.value==="all"||l.value==="users"?(i(!0),_(V,{key:1},x(A.value,e=>(i(),_("div",{key:e.id,class:"user-card card"},[n(I,{to:{name:"userProfile",params:{id:e.id}},class:"user-link"},{default:y(()=>[a("img",{src:C(Q)(e==null?void 0:e.avatar),alt:(e==null?void 0:e.username)||"用户",class:"avatar avatar--medium"},null,8,ve),a("div",ge,[a("h3",he,b(e.username),1),a("p",fe,b(e.bio||C(oe).EMPTY_BIO),1)])]),_:2},1032,["to"])]))),128)):w("",!0),l.value==="all"||l.value==="tags"?(i(),_("div",ye,[s[6]||(s[6]=a("h3",{class:"section-title"},"相关标签",-1)),a("div",ke,[(i(!0),_(V,null,x(E.value,e=>(i(),P(I,{key:e.id,to:{name:"search",query:{tag_id:e.id}},class:"tag-item"},{default:y(()=>[a("span",be,b(e.name),1),a("span",Te,b(e.post_count||0)+" 帖子",1)]),_:2},1032,["to"]))),128))])])):w("",!0),a("div",qe,[n(O,{"current-page":p.value,"onUpdate:currentPage":s[2]||(s[2]=e=>p.value=e),"page-size":h.value,total:r.value,layout:"prev, pager, next",onCurrentChange:z},null,8,["current-page","page-size","total"])])]))]),a("div",Pe,[n(te)])])])])]),_:1})}}}),Ae=ee(Ce,[["__scopeId","data-v-8a4cc731"]]);export{Ae as default};
