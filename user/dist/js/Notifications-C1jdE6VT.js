var w=(x,D,o)=>new Promise((k,h)=>{var g=c=>{try{f(o.next(c))}catch(i){h(i)}},$=c=>{try{f(o.throw(c))}catch(i){h(i)}},f=c=>c.done?k(c.value):Promise.resolve(c.value).then(g,$);f((o=o.apply(x,D)).next())});import{x as ne,r as d,c as P,h as oe,H as S,I as n,z as p,A as a,Q as r,J as le,ag as v,M as m,K as M,aq as re,y as T,P as ie,a6 as ue,D as E,O as L,V as R,am as de,aB as ce}from"./vue-vendor-D9-fr2Es.js";import{M as _e,a as me}from"./MainLayout-ce7fSWOU.js";import{a as y}from"./ui-vendor-BbrJz_TA.js";import"./index-D15Qezav.js";import"./utils-vendor-Cfc3znND.js";const pe={class:"notifications-page"},ve={class:"page-header"},ge={class:"header-actions"},fe={class:"notification-filters"},ye={class:"notifications-content"},ke={class:"notifications-card"},he=["onClick"],we={class:"material-icons-round"},Ce={class:"notification-content"},Te={class:"notification-header"},De=["innerHTML"],$e={class:"notification-actions"},be=["onClick"],Me=["onClick"],Ne={class:"notification-details"},Ve={class:"notification-time"},Ze={key:0,class:"empty-notifications"},Pe={key:0,class:"pagination-container"},Se={class:"dialog-footer"},xe=ne({__name:"Notifications",setup(x){const D=ce(),o=d([]),k=d(!0),h=d(!1),g=d(1),$=d(10),f=d(0),c=d(1),i=d("all"),C=d(!1),b=d(null),N=d(!1),F=P(()=>o.value.filter(e=>!e.read_at).length),A=P(()=>i.value==="all"?o.value:i.value==="unread"?o.value.filter(e=>!e.read_at):o.value.filter(e=>e.type===i.value)),U=P(()=>o.value.some(e=>!e.read_at)),H=e=>{switch(e.type){case"comment":return"comment";case"like":return"thumb_up";case"mention":return"alternate_email";case"system":return"announcement";default:return"notifications"}},O=e=>`icon-bg ${e.type}-icon`,q=e=>{switch(e.type){case"comment":return`<strong>${e.data.user_name}</strong> 在您的帖子 <strong>${e.data.post_title}</strong> 中发表了评论`;case"like":return`<strong>${e.data.user_name}</strong> 赞了您的帖子 <strong>${e.data.post_title}</strong>`;case"mention":return`<strong>${e.data.user_name}</strong> 在帖子 <strong>${e.data.post_title}</strong> 中提到了您`;case"system":return e.data.message||"系统通知";default:return"未知通知"}},G=()=>{switch(i.value){case"unread":return"没有未读通知";case"comment":return"没有评论通知";case"like":return"没有点赞通知";case"system":return"没有系统通知";default:return"暂无通知"}},J=e=>{const t=new Date(e),l=new Date().getTime()-t.getTime();return l<36e5?`${Math.floor(l/6e4)}分钟前`:l<864e5?`${Math.floor(l/36e5)}小时前`:l<6048e5?`${Math.floor(l/864e5)}天前`:`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},V=(e=1,t="all")=>w(null,null,function*(){k.value=!0;try{yield new Promise(_=>setTimeout(_,500));const u=[{id:1,user_id:1,type:"comment",data:{post_id:123,post_title:"如何整理小户型空间",comment_id:456,user_name:"用户A",user_avatar:""},read_at:null,created_at:"2023-06-20T10:30:00Z",updated_at:"2023-06-20T10:30:00Z"},{id:2,user_id:1,type:"like",data:{post_id:123,post_title:"如何整理小户型空间",user_name:"用户B",user_avatar:""},read_at:"2023-06-19T08:45:00Z",created_at:"2023-06-19T08:45:00Z",updated_at:"2023-06-19T08:45:00Z"},{id:3,user_id:1,type:"mention",data:{post_id:789,post_title:"推荐一些家居好物",comment_id:567,user_name:"用户C",user_avatar:""},read_at:null,created_at:"2023-06-18T15:20:00Z",updated_at:"2023-06-18T15:20:00Z"},{id:4,user_id:1,type:"system",data:{message:"您的帐户已成功验证，欢迎加入我们的社区！",link:""},read_at:null,created_at:"2023-06-15T09:00:00Z",updated_at:"2023-06-15T09:00:00Z"},{id:5,user_id:1,type:"like",data:{post_id:456,post_title:"分享我的工作空间布置",user_name:"用户D",user_avatar:""},read_at:null,created_at:"2023-06-14T14:30:00Z",updated_at:"2023-06-14T14:30:00Z"}];let l=u;return t!=="all"&&(t==="unread"?l=u.filter(_=>!_.read_at):l=u.filter(_=>_.type===t)),o.value=l,f.value=l.length,c.value=Math.ceil(f.value/$.value),l}catch(u){return console.error("Failed to fetch notifications:",u),y.error("获取通知失败"),[]}finally{k.value=!1}}),K=e=>w(null,null,function*(){switch(e.read_at||(yield z(e)),e.type){case"comment":case"like":case"mention":D.push({name:"postDetail",params:{id:e.data.post_id}});break;case"system":e.data.link&&D.push(e.data.link);break}}),z=e=>w(null,null,function*(){try{return yield new Promise(t=>setTimeout(t,200)),e.read_at=new Date().toISOString(),y({message:"标记已读成功",type:"success",duration:2e3}),!0}catch(t){return console.error("Failed to mark notification as read:",t),y.error("标记已读失败"),!1}}),Q=()=>w(null,null,function*(){h.value=!0;try{yield new Promise(e=>setTimeout(e,500)),o.value.forEach(e=>{e.read_at||(e.read_at=new Date().toISOString())}),y({message:"已将所有通知标记为已读",type:"success",duration:2e3})}catch(e){console.error("Failed to mark all as read:",e),y.error("标记全部已读失败")}finally{h.value=!1}}),Y=e=>{g.value=e,V(e,i.value)},j=e=>{i.value=e,g.value=1,V(1,e)},W=e=>{b.value=e,C.value=!0},X=()=>w(null,null,function*(){if(b.value){N.value=!0;try{yield new Promise(e=>setTimeout(e,300)),o.value=o.value.filter(e=>e.id!==b.value.id),y({message:"通知已删除",type:"success",duration:2e3}),C.value=!1,b.value=null}catch(e){console.error("Failed to delete notification:",e),y.error("删除通知失败")}finally{N.value=!1}}});return oe(()=>{V(g.value,i.value)}),(e,t)=>{const u=v("el-radio-button"),l=v("el-badge"),_=v("el-radio-group"),Z=v("el-button"),B=v("el-tooltip"),ee=v("el-empty"),te=v("el-pagination"),ae=v("el-dialog"),se=re("loading");return p(),S(_e,null,{default:n(()=>[a("div",pe,[a("div",ve,[t[10]||(t[10]=a("h1",{class:"page-title"},"通知中心",-1)),a("div",ge,[a("div",fe,[r(_,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=s=>i.value=s),size:"small",onChange:j},{default:n(()=>[r(u,{value:"all"},{default:n(()=>t[4]||(t[4]=[m("全部")])),_:1,__:[4]}),r(u,{value:"unread"},{default:n(()=>[t[5]||(t[5]=m(" 未读 ")),F.value>0?(p(),S(l,{key:0,value:F.value,class:"unread-badge"},null,8,["value"])):M("",!0)]),_:1,__:[5]}),r(u,{value:"comment"},{default:n(()=>t[6]||(t[6]=[m("评论")])),_:1,__:[6]}),r(u,{value:"like"},{default:n(()=>t[7]||(t[7]=[m("点赞")])),_:1,__:[7]}),r(u,{value:"system"},{default:n(()=>t[8]||(t[8]=[m("系统")])),_:1,__:[8]})]),_:1},8,["modelValue"])]),r(Z,{type:"primary",plain:"",size:"small",disabled:!U.value||h.value,onClick:Q,class:"mark-read-btn"},{default:n(()=>t[9]||(t[9]=[a("span",{class:"material-icons-round"},"done_all",-1),m(" 全部标为已读 ")])),_:1,__:[9]},8,["disabled"])])]),le((p(),T("div",ye,[a("div",ke,[r(de,{name:"list",tag:"div",class:"notifications-list"},{default:n(()=>[(p(!0),T(ie,null,ue(A.value,s=>(p(),T("div",{key:s.id,class:E(["notification-item",{unread:!s.read_at}]),onClick:I=>K(s)},[a("div",{class:E(["notification-icon",O(s)])},[a("span",we,L(H(s)),1)],2),a("div",Ce,[a("div",Te,[a("div",{class:"notification-message",innerHTML:q(s)},null,8,De),a("div",$e,[s.read_at?M("",!0):(p(),S(B,{key:0,content:"标记为已读",placement:"top"},{default:n(()=>[a("span",{class:"action-icon",onClick:R(I=>z(s),["stop"])},t[11]||(t[11]=[a("span",{class:"material-icons-round"},"done",-1)]),8,be)]),_:2},1024)),r(B,{content:"删除通知",placement:"top"},{default:n(()=>[a("span",{class:"action-icon",onClick:R(I=>W(s),["stop"])},t[12]||(t[12]=[a("span",{class:"material-icons-round"},"delete",-1)]),8,Me)]),_:2},1024)])]),a("div",Ne,[a("div",Ve,[t[13]||(t[13]=a("span",{class:"material-icons-round time-icon"},"schedule",-1)),m(" "+L(J(s.created_at)),1)])])])],10,he))),128))]),_:1}),A.value.length===0&&!k.value?(p(),T("div",Ze,[r(ee,{description:G()},{image:n(()=>t[14]||(t[14]=[a("div",{class:"empty-icon"},[a("span",{class:"material-icons-round"},"notifications_off")],-1)])),_:1},8,["description"])])):M("",!0)]),o.value.length>0&&c.value>1?(p(),T("div",Pe,[r(te,{"current-page":g.value,"onUpdate:currentPage":t[1]||(t[1]=s=>g.value=s),"page-size":$.value,total:f.value,background:!0,layout:"prev, pager, next",onCurrentChange:Y},null,8,["current-page","page-size","total"])])):M("",!0)])),[[se,k.value]])]),r(ae,{modelValue:C.value,"onUpdate:modelValue":t[3]||(t[3]=s=>C.value=s),title:"删除通知",width:"360px",center:""},{footer:n(()=>[a("span",Se,[r(Z,{onClick:t[2]||(t[2]=s=>C.value=!1)},{default:n(()=>t[15]||(t[15]=[m("取消")])),_:1,__:[15]}),r(Z,{type:"primary",onClick:X,loading:N.value},{default:n(()=>t[16]||(t[16]=[m("确定")])),_:1,__:[16]},8,["loading"])])]),default:n(()=>[t[17]||(t[17]=a("span",null,"确定要删除这条通知吗？",-1))]),_:1,__:[17]},8,["modelValue"])]),_:1})}}}),Le=me(xe,[["__scopeId","data-v-dca8d254"]]);export{Le as default};
