const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/About-rTaqScxV.js","js/MainLayout-ce7fSWOU.js","js/vue-vendor-D9-fr2Es.js","js/ui-vendor-BbrJz_TA.js","assets/MainLayout-uc7CmbgL.css","js/utils-vendor-Cfc3znND.js","assets/About-TIV4lKHb.css","js/Category-D4_ZNj1k.js","js/PostCard-B03o2Dre.js","assets/PostCard-DtHvM_0H.css","js/postStore-BYDGKwf5.js","assets/Category-DpfMlcF8.css","js/CreatePost-94m3Pdm3.js","js/editor-vendor-C_CoOyx-.js","js/LoginPrompt-JWDjJrza.js","assets/LoginPrompt-DiYmUAAn.css","assets/CreatePost-B-GZ_mNr.css","assets/vue-quill-DwXE-tNh.css","js/EditPost-BifPhcTs.js","assets/EditPost-DEsO68nh.css","js/Home-C5R9kuTh.js","js/Sidebar-D0plc26K.js","assets/Sidebar-DRrZH7Bg.css","assets/Home-DD61hNCM.css","js/NotFound-DaOVt3CR.js","assets/NotFound-DW-k61mU.css","js/Notifications-C1jdE6VT.js","assets/Notifications-CDMjFi0c.css","js/PostDetail-MI36o54h.js","assets/PostDetail-B5VHJCsS.css","js/Search-CoutU8Gk.js","assets/Search-C8nqgV9p.css","js/Settings-Dmei-0fw.js","assets/Settings-DxFeTlan.css","js/UserProfile-BjeqSVlr.js","assets/UserProfile-B-_w_60N.css"])))=>i.map(i=>d[i]);
var ee=Object.defineProperty,te=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var j=(e,o,t)=>o in e?ee(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,A=(e,o)=>{for(var t in o||(o={}))re.call(o,t)&&j(e,t,o[t]);if(W)for(var t of W(o))ue.call(o,t)&&j(e,t,o[t]);return e},C=(e,o)=>te(e,oe(o));var I=(e,o,t)=>new Promise((r,s)=>{var i=h=>{try{g(t.next(h))}catch(E){s(E)}},c=h=>{try{g(t.throw(h))}catch(E){s(E)}},g=h=>h.done?r(h.value):Promise.resolve(h.value).then(i,c);g((t=t.apply(e,o)).next())});import{aw as se,r as w,c as V,x as ae,h as ne,H as ie,ag as le,z as ce,ax as de,ay as me,at as Ee,az as fe}from"./vue-vendor-D9-fr2Es.js";import{E as ge,a as B,b as pe,i as _e}from"./ui-vendor-BbrJz_TA.js";import{a as he}from"./utils-vendor-Cfc3znND.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var ve={name:"zh-cn",el:{breadcrumb:{label:"面包屑"},colorpicker:{confirm:"确定",clear:"清空",defaultLabel:"颜色选择器",description:"当前颜色 {color}，按 Enter 键选择新颜色",alphaLabel:"选择透明度的值"},datepicker:{now:"此刻",today:"今天",cancel:"取消",clear:"清空",confirm:"确定",dateTablePrompt:"使用方向键与 Enter 键可选择日期",monthTablePrompt:"使用方向键与 Enter 键可选择月份",yearTablePrompt:"使用方向键与 Enter 键可选择年份",selectedDate:"已选日期",selectDate:"选择日期",selectTime:"选择时间",startDate:"开始日期",startTime:"开始时间",endDate:"结束日期",endTime:"结束时间",prevYear:"前一年",nextYear:"后一年",prevMonth:"上个月",nextMonth:"下个月",year:"年",month1:"1 月",month2:"2 月",month3:"3 月",month4:"4 月",month5:"5 月",month6:"6 月",month7:"7 月",month8:"8 月",month9:"9 月",month10:"10 月",month11:"11 月",month12:"12 月",weeks:{sun:"日",mon:"一",tue:"二",wed:"三",thu:"四",fri:"五",sat:"六"},weeksFull:{sun:"星期日",mon:"星期一",tue:"星期二",wed:"星期三",thu:"星期四",fri:"星期五",sat:"星期六"},months:{jan:"一月",feb:"二月",mar:"三月",apr:"四月",may:"五月",jun:"六月",jul:"七月",aug:"八月",sep:"九月",oct:"十月",nov:"十一月",dec:"十二月"}},inputNumber:{decrease:"减少数值",increase:"增加数值"},select:{loading:"加载中",noMatch:"无匹配数据",noData:"无数据",placeholder:"请选择"},dropdown:{toggleDropdown:"切换下拉选项"},mention:{loading:"加载中"},cascader:{noMatch:"无匹配数据",loading:"加载中",placeholder:"请选择",noData:"暂无数据"},pagination:{goto:"前往",pagesize:"条/页",total:"共 {total} 条",pageClassifier:"页",page:"页",prev:"上一页",next:"下一页",currentPage:"第 {pager} 页",prevPages:"向前 {pager} 页",nextPages:"向后 {pager} 页",deprecationWarning:"你使用了一些已被废弃的用法，请参考 el-pagination 的官方文档"},dialog:{close:"关闭此对话框"},drawer:{close:"关闭此对话框"},messagebox:{title:"提示",confirm:"确定",cancel:"取消",error:"输入的数据不合法!",close:"关闭此对话框"},upload:{deleteTip:"按 Delete 键可删除",delete:"删除",preview:"查看图片",continue:"继续上传"},slider:{defaultLabel:"滑块介于 {min} 至 {max}",defaultRangeStartLabel:"选择起始值",defaultRangeEndLabel:"选择结束值"},table:{emptyText:"暂无数据",confirmFilter:"筛选",resetFilter:"重置",clearFilter:"全部",sumText:"合计"},tour:{next:"下一步",previous:"上一步",finish:"结束导览"},tree:{emptyText:"暂无数据"},transfer:{noMatch:"无匹配数据",noData:"无数据",titles:["列表 1","列表 2"],filterPlaceholder:"请输入搜索内容",noCheckedFormat:"共 {total} 项",hasCheckedFormat:"已选 {checked}/{total} 项"},image:{error:"加载失败"},pageHeader:{title:"返回"},popconfirm:{confirmButtonText:"确定",cancelButtonText:"取消"},carousel:{leftArrow:"上一张幻灯片",rightArrow:"下一张幻灯片",indicator:"幻灯片切换至索引 {index}"}}};const Ae={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_URL:"http://localhost:8080/api",VITE_APP_DESCRIPTION:"生活技巧分享社区",VITE_APP_TITLE:"Lumen论坛"};function z(e,o=""){return Ae[e]||o}const R={api:{baseURL:z("VITE_API_URL","http://localhost:8080/api"),timeout:1e4},app:{title:z("VITE_APP_TITLE","Lumen论坛"),description:z("VITE_APP_DESCRIPTION","生活技巧分享社区")}},Ie=()=>[R.api.baseURL,R.app.title].every(o=>o&&o.trim().length>0);Ie()||console.error("❌ Configuration validation failed!");const D={BASE_URL:R.api.baseURL,TIMEOUT:R.api.timeout,DEFAULT_PAGE_SIZE:10,MAX_PAGE_SIZE:100},He={MINUTE:60*1e3,HOUR:60*60*1e3,DAY:24*60*60*1e3,WEEK:7*24*60*60*1e3},Ge={POST_EXCERPT_LENGTH:120,COMMENT_PREVIEW_LENGTH:100,TITLE_MAX_LENGTH:200,BIO_MAX_LENGTH:500},xe={UNKNOWN_USER:"未知用户",UNKNOWN_CATEGORY:"未知分类",UNKNOWN_TITLE:"未知标题",EMPTY_BIO:"这个用户很懒，还没有填写个人简介",LOADING:"加载中...",NO_DATA:"暂无数据"},L={NETWORK_ERROR:"网络连接失败，请检查网络设置",AUTH_FAILED:"认证失败，请重新登录",VALIDATION_FAILED:"数据验证失败，请检查输入",FETCH_CATEGORIES_FAILED:"获取分类列表失败",FETCH_POSTS_FAILED:"获取帖子列表失败",FETCH_USER_FAILED:"获取用户信息失败"},O=he.create({baseURL:D.BASE_URL,headers:{"Content-Type":"application/json",Accept:"application/json"},timeout:D.TIMEOUT});O.interceptors.request.use(e=>{const o=localStorage.getItem("token")||sessionStorage.getItem("token");return o&&e.headers&&(e.headers.Authorization=`${o}`),e},e=>Promise.reject(e));O.interceptors.response.use(e=>{const{code:o,message:t,data:r}=e.data;if(o===200)return C(A({},e),{data:r});{const s=new Error(t||"请求失败");throw s.code=o,s}},e=>{if(e.response){const{status:o,data:t}=e.response;t&&t.message&&(e.message=t.message)}return Promise.reject(e)});const _=(e,o={},t={})=>O.get(e,A({params:o},t)).then(r=>r.data),U=(e,o={},t={})=>O.post(e,o,t).then(r=>r.data),ye=(e,o={},t={})=>O.put(e,o,t).then(r=>r.data),We={getCategories:()=>_("/content/categories"),getCategoryById:e=>_(`/content/categories/${e}`)},H={getCurrentUser:()=>_("/users/me"),getUserById:e=>_(`/users/${e}`),updateProfile:e=>ye("/users/profile",e),getActiveUsers:(e=0,o=D.DEFAULT_PAGE_SIZE)=>_("/users/active",{page:e,size:o})},je={getPosts:(e=0,o=D.DEFAULT_PAGE_SIZE)=>_("/content/posts",{page:e,size:o}),getPostById:e=>_(`/content/posts/${e}`),getUserPosts:(e,o=0,t=D.DEFAULT_PAGE_SIZE)=>_("/content/posts/user",{id:e,page:o,size:t}),getCategoryPosts:(e,o=0,t=D.DEFAULT_PAGE_SIZE)=>_("/content/posts/categories",{id:e,page:o,size:t}),getHotPosts:(e=0,o=D.DEFAULT_PAGE_SIZE)=>_("/content/posts/hot",{page:e,size:o}),getHotPostsSide:(e=0,o=5)=>_("/content/posts/hot/side",{page:e,size:o}),getRecommendedPosts:(e=0,o=D.DEFAULT_PAGE_SIZE)=>_("/content/posts/recommended",{page:e,size:o}),getRecommendedPostsSide:(e=0,o=5)=>_("/content/posts/recommended/side",{page:e,size:o})},b={sendCode:(e,o)=>U("/auth/login/code",{loginType:e,identifier:o}),login:(e,o,t,r=!1)=>U("/auth/login",{loginType:e,identifier:o,code:t,rememberMe:r}),logout:()=>U("/auth/logout")};class p{static handleApiError(o){let t={type:"API",message:"请求失败"};if(o.response){const{status:r,data:s}=o.response;switch(t.code=r,r){case 400:t.message=(s==null?void 0:s.message)||"请求参数错误",t.type="VALIDATION";break;case 401:t.message="登录已过期，请重新登录",t.type="AUTH";break;case 403:t.message="没有权限访问此资源",t.type="AUTH";break;case 404:t.message="请求的资源不存在";break;case 429:t.message="请求过于频繁，请稍后再试";break;case 500:t.message="服务器内部错误";break;case 502:t.message="网关错误";break;case 503:t.message="服务暂时不可用";break;default:t.message=(s==null?void 0:s.message)||`请求失败 (${r})`}t.details=s}else o.request?(t.type="NETWORK",t.message="网络连接失败，请检查网络设置"):(t.type="UNKNOWN",t.message=o.message||"未知错误");return t}static showError(o,t=!1){const{type:r,message:s}=o;t?ge({title:this.getErrorTitle(r),message:s,type:"error",duration:5e3}):B({message:s,type:"error",duration:3e3,showClose:!0})}static getErrorTitle(o){switch(o){case"NETWORK":return"网络错误";case"API":return"API错误";case"AUTH":return"认证错误";case"VALIDATION":return"验证错误";default:return"系统错误"}}static handleAndShow(o,t=!1){const r=this.handleApiError(o);return this.showError(r,t),r}static logError(o,t){const r=this.handleApiError(o);console.group(`🚨 Error ${t?`in ${t}`:""}`),console.error("Error Info:",r),console.error("Original Error:",o),console.groupEnd()}static createUserFriendlyMessage(o){const t=this.handleApiError(o);switch(t.type){case"NETWORK":return"网络连接不稳定，请检查网络后重试";case"AUTH":return"登录状态已过期，请重新登录";case"VALIDATION":return t.message||"输入信息有误，请检查后重试";default:return t.message||"操作失败，请稍后重试"}}}const $=p.handleAndShow;p.logError;p.createUserFriendlyMessage;const De=()=>{window.addEventListener("unhandledrejection",e=>{$(e.reason,"Unhandled Promise Rejection"),e.preventDefault()}),window.addEventListener("error",e=>{$({message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error},"Global Error")})},S=se("user",()=>{const e=w(null),o=w(null),t=w(!1),r=w(null),s=V(()=>!!o.value),i=V(()=>{var u,a,n,l;return(l=(n=(u=e.value)==null?void 0:u.isAdmin)!=null?n:(a=e.value)==null?void 0:a.is_admin)!=null?l:!1}),c=V(()=>{var u,a,n,l;return(l=(n=(u=e.value)==null?void 0:u.isModerator)!=null?n:(a=e.value)==null?void 0:a.is_moderator)!=null?l:!1}),g=u=>{var a,n,l,f,d,x;return{id:u.id,username:u.username,email:u.email,phone:u.phone,avatar:u.avatar||"/img/avatar-default.png",bio:u.bio||"",website:u.website||"",location:u.location||"",title:u.title||"",showEmail:(a=u.showEmail)!=null?a:!1,reputation:(n=u.reputation)!=null?n:0,postCount:(l=u.postCount)!=null?l:0,commentCount:(f=u.commentCount)!=null?f:0,isAdmin:(d=u.isAdmin)!=null?d:!1,isModerator:(x=u.isModerator)!=null?x:!1,moderatedCategory:u.moderatedCategory,emailVerifiedAt:u.emailVerifiedAt,phoneVerifiedAt:u.phoneVerifiedAt,lastActiveAt:u.lastActiveAt,rememberToken:u.rememberToken,deleted:u.deleted,createdAt:u.createdAt,updatedAt:u.updatedAt,created_at:u.created_at||u.createdAt,updated_at:u.updated_at||u.updatedAt,last_active_at:u.last_active_at||u.lastActiveAt,post_count:u.post_count||u.postCount,comment_count:u.comment_count||u.commentCount,is_admin:u.is_admin||u.isAdmin,is_moderator:u.is_moderator||u.isModerator,show_email:u.show_email||u.showEmail,cover_image:u.cover_image,skills:u.skills||[],social_links:u.social_links||[]}};function h(){const u=localStorage.getItem("token"),a=localStorage.getItem("user"),n=sessionStorage.getItem("token"),l=sessionStorage.getItem("user");if(u?o.value=u:n&&(o.value=n),a)try{e.value=JSON.parse(a)}catch(f){localStorage.removeItem("user")}else if(l)try{e.value=JSON.parse(l)}catch(f){sessionStorage.removeItem("user")}}function E(u,a,n=!1){return I(this,null,function*(){t.value=!0,r.value=null;try{const l=yield b.login("SMS",u,a,n),{token:f,userContext:d}=l;return o.value=f,e.value={id:d.userId,username:d.username,avatar:d.avatar||"/img/avatar-default.png",email:"",phone:u,bio:"",website:"",location:"",title:"",showEmail:!1,reputation:0,postCount:0,commentCount:0,isAdmin:d.isAdmin||!1,isModerator:d.isModerator||!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),last_active_at:new Date().toISOString(),post_count:0,comment_count:0,is_admin:d.isAdmin||!1,is_moderator:d.isModerator||!1,show_email:!1},n?(localStorage.setItem("token",f),localStorage.setItem("user",JSON.stringify(e.value))):(sessionStorage.setItem("token",f),sessionStorage.setItem("user",JSON.stringify(e.value))),!0}catch(l){const f=p.handleApiError(l);return r.value=L.AUTH_FAILED,p.showError(f),!1}finally{t.value=!1}})}function y(u,a,n=!1){return I(this,null,function*(){t.value=!0,r.value=null;try{const l=yield b.login("EMAIL",u,a,n),{token:f,userContext:d}=l;return o.value=f,e.value={id:d.userId,username:d.username,avatar:d.avatar||"/img/avatar-default.png",email:u,bio:"",website:"",location:"",title:"",showEmail:!1,reputation:0,postCount:0,commentCount:0,isAdmin:d.isAdmin||!1,isModerator:d.isModerator||!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),last_active_at:new Date().toISOString(),post_count:0,comment_count:0,is_admin:d.isAdmin||!1,is_moderator:d.isModerator||!1,show_email:!1},n?(localStorage.setItem("token",f),localStorage.setItem("user",JSON.stringify(e.value))):(sessionStorage.setItem("token",f),sessionStorage.setItem("user",JSON.stringify(e.value))),!0}catch(l){const f=p.handleApiError(l);return r.value=L.AUTH_FAILED,p.showError(f),!1}finally{t.value=!1}})}function F(){return I(this,null,function*(){t.value=!0,r.value=null;try{yield b.logout()}catch(u){}finally{o.value=null,e.value=null,localStorage.removeItem("token"),localStorage.removeItem("user"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user"),t.value=!1}})}function v(){return I(this,null,function*(){t.value=!0,r.value=null;try{const u=yield H.getCurrentUser(),a=g(u);return e.value=a,(localStorage.getItem("token")||sessionStorage.getItem("token"))&&(localStorage.getItem("token")?localStorage.setItem("user",JSON.stringify(a)):sessionStorage.setItem("user",JSON.stringify(a))),a}catch(u){const a=p.handleApiError(u);return r.value=L.FETCH_USER_FAILED,p.showError(a),null}finally{t.value=!1}})}function N(u){return I(this,null,function*(){t.value=!0,r.value=null;try{const a=yield H.updateProfile(u);return e.value=a,(localStorage.getItem("token")||sessionStorage.getItem("token"))&&(localStorage.getItem("token")?localStorage.setItem("user",JSON.stringify(a)):sessionStorage.setItem("user",JSON.stringify(a))),a}catch(a){const n=p.handleApiError(a);return r.value=L.VALIDATION_FAILED,p.showError(n),null}finally{t.value=!1}})}function M(u,a){return I(this,null,function*(){t.value=!0,r.value=null;try{return yield b.sendCode(u,a),!0}catch(n){const l=p.handleApiError(n);return r.value=L.NETWORK_ERROR,p.showError(l),!1}finally{t.value=!1}})}function Q(){return I(this,null,function*(){var u;if(!o.value)return!1;try{const a=yield H.getCurrentUser();return e.value=a,(localStorage.getItem("token")||sessionStorage.getItem("token"))&&(localStorage.getItem("token")?localStorage.setItem("user",JSON.stringify(a)):sessionStorage.setItem("user",JSON.stringify(a))),!0}catch(a){return((u=a.response)==null?void 0:u.status)===401&&(o.value=null,e.value=null,localStorage.removeItem("token"),localStorage.removeItem("user"),sessionStorage.removeItem("token"),sessionStorage.removeItem("user")),!1}})}return{currentUser:e,token:o,loading:t,error:r,isAuthenticated:s,isAdmin:i,isModerator:c,initFromLocalStorage:h,loginWithPhone:E,loginWithEmail:y,logout:F,fetchCurrentUser:v,updateProfile:N,sendVerificationCode:M,validateTokenAndFetchUser:Q}}),Fe=ae({__name:"App",setup(e){const o=S();return ne(()=>I(null,null,function*(){o.initFromLocalStorage(),o.token&&(yield o.validateTokenAndFetchUser())})),(t,r)=>{const s=le("router-view");return ce(),ie(s)}}}),Se="modulepreload",Te=function(e){return"/"+e},q={},m=function(o,t,r){let s=Promise.resolve();if(t&&t.length>0){let h=function(E){return Promise.all(E.map(y=>Promise.resolve(y).then(F=>({status:"fulfilled",value:F}),F=>({status:"rejected",reason:F}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),g=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=h(t.map(E=>{if(E=Te(E),E in q)return;q[E]=!0;const y=E.endsWith(".css"),F=y?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${E}"]${F}`))return;const v=document.createElement("link");if(v.rel=y?"stylesheet":Se,y||(v.as="script"),v.crossOrigin="",v.href=E,g&&v.setAttribute("nonce",g),document.head.appendChild(v),y)return new Promise((N,M)=>{v.addEventListener("load",N),v.addEventListener("error",()=>M(new Error(`Unable to preload CSS for ${E}`)))})}))}function i(c){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=c,window.dispatchEvent(g),!g.defaultPrevented)throw c}return s.then(c=>{for(const g of c||[])g.status==="rejected"&&i(g.reason);return o().catch(i)})},Le=(e,o,t)=>{const r=e[o];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((s,i)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(i.bind(null,new Error("Unknown variable dynamic import: "+o+(o.split("/").length!==t?". Note that variables only represent file names one level deep.":""))))})},P=(e,o)=>()=>Le(Object.assign({"../pages/About.vue":()=>m(()=>import("./About-rTaqScxV.js"),__vite__mapDeps([0,1,2,3,4,5,6])),"../pages/Category.vue":()=>m(()=>import("./Category-D4_ZNj1k.js"),__vite__mapDeps([7,2,1,3,4,8,9,10,5,11])),"../pages/CreatePost.vue":()=>m(()=>import("./CreatePost-94m3Pdm3.js"),__vite__mapDeps([12,2,3,1,4,10,13,14,15,5,16,17])),"../pages/EditPost.vue":()=>m(()=>import("./EditPost-BifPhcTs.js"),__vite__mapDeps([18,2,1,3,4,10,13,5,19,17])),"../pages/Home.vue":()=>m(()=>import("./Home-C5R9kuTh.js"),__vite__mapDeps([20,2,1,3,4,8,9,10,21,22,5,23])),"../pages/NotFound.vue":()=>m(()=>import("./NotFound-DaOVt3CR.js"),__vite__mapDeps([24,1,2,3,4,5,25])),"../pages/Notifications.vue":()=>m(()=>import("./Notifications-C1jdE6VT.js"),__vite__mapDeps([26,2,1,3,4,5,27])),"../pages/PostDetail.vue":()=>m(()=>import("./PostDetail-MI36o54h.js"),__vite__mapDeps([28,2,1,3,4,14,15,10,5,29])),"../pages/Search.vue":()=>m(()=>import("./Search-CoutU8Gk.js"),__vite__mapDeps([30,2,3,1,4,8,9,21,22,10,5,31])),"../pages/Settings.vue":()=>m(()=>import("./Settings-Dmei-0fw.js"),__vite__mapDeps([32,2,1,3,4,5,33])),"../pages/UserProfile.vue":()=>m(()=>import("./UserProfile-BjeqSVlr.js"),__vite__mapDeps([34,2,1,3,4,8,9,10,5,35]))}),`../pages/${e}.vue`,3).catch(r=>(console.error(`Failed to load component: ${e}`,r),m(()=>import("./NotFound-DaOVt3CR.js"),__vite__mapDeps([24,1,2,3,4,5,25])))),Pe=[{path:"/",name:"home",component:P("Home"),meta:{title:"Lumen论坛 - 首页",preload:!0}},{path:"/post/:id",name:"postDetail",component:P("PostDetail"),props:!0,meta:{title:"帖子详情 - Lumen论坛",preload:!0}},{path:"/category/:id",name:"category",component:P("Category"),props:!0,meta:{title:"分类浏览 - Lumen论坛"}},{path:"/user/:id",name:"userProfile",component:P("UserProfile"),props:!0,meta:{title:"用户资料 - Lumen论坛"}},{path:"/create-post",name:"createPost",component:P("CreatePost"),meta:{title:"发布帖子 - Lumen论坛",requiresAuth:!0}},{path:"/edit-post/:id",name:"editPost",component:()=>m(()=>import("./EditPost-BifPhcTs.js"),__vite__mapDeps([18,2,1,3,4,10,13,5,19,17])),props:!0,meta:{title:"编辑帖子 - Lumen论坛",requiresAuth:!0}},{path:"/search",name:"search",component:()=>m(()=>import("./Search-CoutU8Gk.js"),__vite__mapDeps([30,2,3,1,4,8,9,21,22,10,5,31])),meta:{title:"搜索结果 - Lumen论坛"}},{path:"/settings",name:"settings",component:()=>m(()=>import("./Settings-Dmei-0fw.js"),__vite__mapDeps([32,2,1,3,4,5,33])),meta:{title:"设置 - Lumen论坛",requiresAuth:!0}},{path:"/notifications",name:"notifications",component:()=>m(()=>import("./Notifications-C1jdE6VT.js"),__vite__mapDeps([26,2,1,3,4,5,27])),meta:{title:"通知 - Lumen论坛",requiresAuth:!0}},{path:"/about",name:"about",component:()=>m(()=>import("./About-rTaqScxV.js"),__vite__mapDeps([0,1,2,3,4,5,6])),meta:{title:"关于我们 - Lumen论坛"}},{path:"/404",name:"notFound",component:()=>m(()=>import("./NotFound-DaOVt3CR.js"),__vite__mapDeps([24,1,2,3,4,5,25])),meta:{title:"页面未找到 - Lumen论坛"}},{path:"/:pathMatch(.*)*",redirect:"/404"}],Z=de({history:me(),routes:Pe,scrollBehavior(e,o,t){return t||{top:0}}});Z.beforeEach((e,o,t)=>{if(e.meta.title&&(document.title=e.meta.title),e.matched.some(r=>r.meta.requiresAuth)){const r=S();r.isAuthenticated?e.meta.requiresAdmin&&!r.isAdmin?(B({message:"您没有权限访问此页面",type:"error",duration:3e3}),t({path:"/"})):e.meta.requiresModerator&&!r.isModerator&&!r.isAdmin?(B({message:"您没有权限访问此页面",type:"error",duration:3e3}),t({path:"/"})):t():(B({message:"您需要登录才能访问此页面",type:"warning",duration:3e3}),t({path:"/",query:{redirect:e.fullPath}}))}else t()});function J(e){const o=S();return e==="guest"?!0:o.isAuthenticated?o.isAdmin||o.isModerator&&e!=="admin"||o.currentUser&&o.currentUser.reputation>=100&&e!=="admin"&&e!=="moderator"?!0:e==="user":!1}function X(e){var t;return((t=S().currentUser)==null?void 0:t.id)===e}function Y(e){const o=S();return X(e)||o.isAdmin||o.isModerator}function Oe(e){return Y(e)}const Ce={mounted(e,o){const{value:t}=o;let r=!1;typeof t=="string"?r=J(t):typeof t=="object"&&(t.type==="edit"&&t.resourceUserId!==void 0?r=Y(t.resourceUserId):t.type==="delete"&&t.resourceUserId!==void 0?r=Oe(t.resourceUserId):t.type==="owner"&&t.resourceUserId!==void 0?r=X(t.resourceUserId):t.type==="level"&&(r=J(t.level))),r||(e.style.display="none")}},we={permission:Ce};function be(e){Object.entries(we).forEach(([o,t])=>{e.directive(o,t)})}const k={src:"",loading:"/img/loading.gif",error:"/img/error.png",threshold:.1,rootMargin:"50px",once:!0},ke=e=>new IntersectionObserver(o=>{o.forEach(t=>{const r=t.target;t.isIntersecting&&(G(r,e),e.once&&r._lazyLoadObserver&&r._lazyLoadObserver.unobserve(r))})},{threshold:e.threshold,rootMargin:e.rootMargin}),G=(e,o)=>{if(e._lazyLoadLoaded)return;const t=e._lazyLoadSrc||o.src;if(!t)return;e.classList.add("lazy-loading");const r=new Image;r.onload=()=>{e.tagName==="IMG"?e.src=t:e.style.backgroundImage=`url(${t})`,e.classList.remove("lazy-loading"),e.classList.add("lazy-loaded"),e._lazyLoadLoaded=!0,e.dispatchEvent(new CustomEvent("lazy-loaded",{detail:{src:t}}))},r.onerror=()=>{const s=o.error;s&&(e.tagName==="IMG"?e.src=s:e.style.backgroundImage=`url(${s})`),e.classList.remove("lazy-loading"),e.classList.add("lazy-error"),e.dispatchEvent(new CustomEvent("lazy-error",{detail:{src:t,error:"Failed to load image"}}))},r.src=t},K=(e,o)=>{o.loading&&(e.tagName==="IMG"?e.src=o.loading:e.style.backgroundImage=`url(${o.loading})`),e.classList.add("lazy-placeholder")},Be={mounted(e,o){let t;if(typeof o.value=="string"?t=C(A({},k),{src:o.value}):t=A(A({},k),o.value),e._lazyLoadSrc=t.src,!window.IntersectionObserver){G(e,t);return}K(e,t),e._lazyLoadObserver=ke(t),e._lazyLoadObserver.observe(e)},updated(e,o){var r;let t;if(typeof o.value=="string"?t=o.value:t=((r=o.value)==null?void 0:r.src)||"",t!==e._lazyLoadSrc){e._lazyLoadSrc=t,e._lazyLoadLoaded=!1,e.classList.remove("lazy-loaded","lazy-error");let s;if(typeof o.value=="string"?s=C(A({},k),{src:o.value}):s=A(A({},k),o.value),e._lazyLoadObserver){const i=e.getBoundingClientRect();i.top<window.innerHeight&&i.bottom>0?G(e,s):K(e,s)}}},unmounted(e){e._lazyLoadObserver&&(e._lazyLoadObserver.disconnect(),delete e._lazyLoadObserver),delete e._lazyLoadSrc,delete e._lazyLoadLoaded}},Re=e=>{e.directive("lazy",Be)},T=Ee(Fe);for(const[e,o]of Object.entries(pe))T.component(e,o);be(T);Re(T);De();T.config.errorHandler=(e,o,t)=>{console.error("全局错误处理:",e,o,t)};T.use(fe()).use(Z).use(_e,{locale:ve,size:"default"});const Ne=S();Ne.initFromLocalStorage();T.mount("#app");export{D as A,xe as D,p as E,Ge as T,Y as a,Oe as b,J as c,L as d,He as e,We as f,H as g,X as i,je as p,S as u};
